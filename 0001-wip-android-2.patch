From d1795e451b3a76535c7c98d7f826018f890c9bb1 Mon Sep 17 00:00:00 2001
From: Nicolas Capens <capn@google.com>
Date: Tue, 25 Nov 2014 13:11:12 -0500
Subject: [PATCH] wip-android-2

Change-Id: I8fe1b9c72abf95dac123ab41c07d8fb19c88e188
---
 src/OpenGL/libEGL/Config.cpp         |  5 +++++
 src/OpenGL/libEGL/main.cpp           |  2 +-
 src/OpenGL/libGLES_CM/libGLES_CM.cpp | 12 ++++++------
 src/Renderer/Renderer.cpp            |  2 ++
 4 files changed, 14 insertions(+), 7 deletions(-)

diff --git a/src/OpenGL/libEGL/Config.cpp b/src/OpenGL/libEGL/Config.cpp
index 61a94d7..12c5e35 100644
--- a/src/OpenGL/libEGL/Config.cpp
+++ b/src/OpenGL/libEGL/Config.cpp
@@ -17,6 +17,9 @@
 
 #include "common/debug.h"
 
+#define EGLAPI
+#include <EGL/eglext.h>
+
 #include <algorithm>
 #include <vector>
 
@@ -321,6 +324,8 @@ bool ConfigSet::getConfigs(EGLConfig *configs, const EGLint *attribList, EGLint
             case EGL_MAX_PBUFFER_WIDTH:       match = config->mMaxPBufferWidth >= attribute[1];                 break;
             case EGL_MAX_PBUFFER_HEIGHT:      match = config->mMaxPBufferHeight >= attribute[1];                break;
             case EGL_MAX_PBUFFER_PIXELS:      match = config->mMaxPBufferPixels >= attribute[1];                break;
+			case EGL_RECORDABLE_ANDROID:      match = true;                                                    break;
+			case EGL_FRAMEBUFFER_TARGET_ANDROID: match = true; break;
 			default:
 				UNIMPLEMENTED();
 				match = false;
diff --git a/src/OpenGL/libEGL/main.cpp b/src/OpenGL/libEGL/main.cpp
index 80882ce..55ac20c 100644
--- a/src/OpenGL/libEGL/main.cpp
+++ b/src/OpenGL/libEGL/main.cpp
@@ -169,7 +169,7 @@ extern "C" BOOL WINAPI DllMain(HINSTANCE instance, DWORD reason, LPVOID reserved
     switch(reason)
     {
     case DLL_PROCESS_ATTACH:
-		if(false)
+		if(true)
 		{
 			WaitForDebugger(instance);
 		}
diff --git a/src/OpenGL/libGLES_CM/libGLES_CM.cpp b/src/OpenGL/libGLES_CM/libGLES_CM.cpp
index 0374df9..422defd 100644
--- a/src/OpenGL/libGLES_CM/libGLES_CM.cpp
+++ b/src/OpenGL/libGLES_CM/libGLES_CM.cpp
@@ -3618,7 +3618,7 @@ void GL_APIENTRY glScissor(GLint x, GLint y, GLsizei width, GLsizei height)
 
 void GL_APIENTRY glShadeModel(GLenum mode)
 {
-	UNIMPLEMENTED();
+	//UNIMPLEMENTED();
 }
 
 void GL_APIENTRY glStencilFunc(GLenum func, GLint ref, GLuint mask)
@@ -3771,12 +3771,12 @@ void GL_APIENTRY glTexEnvfv(GLenum target, GLenum pname, const GLfloat *params)
 
 void GL_APIENTRY glTexEnvi(GLenum target, GLenum pname, GLint param)
 {
-	UNIMPLEMENTED();
+	//UNIMPLEMENTED();
 }
 
 void GL_APIENTRY glTexEnvx(GLenum target, GLenum pname, GLfixed param)
 {
-	UNIMPLEMENTED();
+	//UNIMPLEMENTED();
 }
 
 void GL_APIENTRY glTexEnviv(GLenum target, GLenum pname, const GLint *params)
@@ -4054,7 +4054,7 @@ void GL_APIENTRY glTexParameteri(GLenum target, GLenum pname, GLint param)
                 }
                 break;
 			case GL_TEXTURE_CROP_RECT_OES:
-				UNIMPLEMENTED();
+				//UNIMPLEMENTED();
 				break;
             default:
                 return error(GL_INVALID_ENUM);
@@ -4074,7 +4074,7 @@ void GL_APIENTRY glTexParameteriv(GLenum target, GLenum pname, const GLint* para
 
 void GL_APIENTRY glTexParameterx(GLenum target, GLenum pname, GLfixed param)
 {
-	UNIMPLEMENTED();
+	//UNIMPLEMENTED();
 }
 
 void GL_APIENTRY glTexParameterxv(GLenum target, GLenum pname, const GLfixed *params)
@@ -4262,7 +4262,7 @@ void GL_APIENTRY glDrawTexsOES(GLshort x, GLshort y, GLshort z, GLshort width, G
 
 void GL_APIENTRY glDrawTexiOES(GLint x, GLint y, GLint z, GLint width, GLint height)
 {
-    UNIMPLEMENTED();
+    //UNIMPLEMENTED();
 }
 
 void GL_APIENTRY glDrawTexxOES(GLfixed x, GLfixed y, GLfixed z, GLfixed width, GLfixed height)
diff --git a/src/Renderer/Renderer.cpp b/src/Renderer/Renderer.cpp
index 27ef798..84180f3 100644
--- a/src/Renderer/Renderer.cpp
+++ b/src/Renderer/Renderer.cpp
@@ -2500,6 +2500,8 @@ namespace sw
 			default: threadCount = configuration.threadCount; break;
 			}
 
+			threadCount = 1;
+
 			CPUID::setEnableSSE4_1(configuration.enableSSE4_1);
 			CPUID::setEnableSSSE3(configuration.enableSSSE3);
 			CPUID::setEnableSSE3(configuration.enableSSE3);
-- 
1.8.5.2.msysgit.0

