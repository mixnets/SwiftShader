#!/bin/bash

# Run a GN-built Android binary on the connected device.
#
# Example usage:
#  $ cd out-android ; make unittests
#  $ ../droid unittests
#
# See https://skia.org/user/quick/gn for build instructions.

dst_dir=/data/local/tmp
path="$1"
name="$(basename "$path")"
shift

set -e
set -x

for lib in libEGL.so libGLESv2.so libvk_swiftshader.so; do
    adb push --sync "$lib" "${dst_dir}/${lib}"
done

adb push --sync "$HOME/Android/Sdk/ndk-bundle/sources/cxx-stl/llvm-libc++/libs/arm64-v8a/libc++_shared.so" "${dst_dir}/libc++_shared.so"

adb push --sync "$path" "${dst_dir}/${name}"
adb shell "cd \"$dst_dir\"; chmod +x \"$name\"; LD_LIBRARY_PATH=. ./$name $*"
